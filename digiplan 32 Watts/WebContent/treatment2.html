

<!DOCTYPE HTML>
<HTML>
<HEAD>
    <TITLE>JSC3D Demo</TITLE>
    <script type="text/javascript" src="scripts/jsc3d.js"></script>
    <script type="text/javascript" src="scripts/jsc3d.webgl.js"></script>
    <script type="text/javascript" src="scripts/jsc3d.touch.js"></script>
        <link href="CSS/pe-icon-7-stroke.css" rel="stylesheet" />
        <link href="CSS/font-awesome.css" rel="stylesheet" />
        <link href="CSS/modalstyle.css" rel="stylesheet" />
        <link href="CSS/slider.css" rel="stylesheet" />
	<link href="CSS/ct-navbar.css" rel="stylesheet" />  
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="CSS/bootstrap.css">
  <script src="script/jquery.js"></script>
  <script
  src="https://code.jquery.com/jquery-3.2.1.js"
  integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE="
  crossorigin="anonymous"></script>
  <script src="scripts/bootstrap.min.js"></script>
  <script type="text/javascript" src="script/angular.min.js"></script>
<style type="text/css">

.containerimage {
    position: relative;
    background-color: black;
    box-shadow:2px 2px 10px gray;
}
.image {
  opacity: 1;
  display: block;
  
 	width:100%; height: 200px;
  transition: .5s ease;
  backface-visibility: hidden;
}

.middle {
  transition: .5s ease;
  opacity: 0;
  position: absolute;
  top: 0%;
  left: 90%;
  
}

.containerimage:hover .image {
  opacity: 0.6;
}

.containerimage:hover .middle {
  opacity: 1;
}

.text {
  background-color: #4CAF50;
  color: white;
  font-size: 16px;
  padding: 16px 32px;
}

</style>

</HEAD>

<BODY ng-app="app" ng-controller="cont" style="" ng-init="">
 <nav class="navbar navbar-ct-red  " style="height: 75px; background-color: black;" >
          
          <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
              <ul class="nav navbar-nav " style="margin-left: -120px; margin-top: -5px;" >
                    <li>
                        <a ng-click=" drawboard();">
                           <i> <img src="icons/gridicon.png" width="25px" ></i>
                            <p style="margin-top: 5px;">Grid</p>
                        </a>
                    </li>

                    <li>
                        <a ng-click=" changescene('d.stl');">
                           <i> <img src="icons/lowergum.png" width="50px" height="42px" ></i>
                            <p style="margin-top: -10px;">Lower</p>
                        </a>
                    </li> 
                    <li >
                         <a ng-click=" changescene('x.stl')">
                           <i> <img src="icons/uppergum.png" style="margin-top: -5px;" width="50px"height="42px" ></i>
                            <p style="margin-top: -5px;">Upper</p>
                        </a>
                          
                    </li>
                    
                    <li >
                         <a ng-click=" showsplimage()" >
                           <i class="fa fa-slack" style="font-size:33px; color:white; font-weight: lighter;" > </i>
                            <p style="margin-top: 0px;">Number</p>
                        </a>
                        
                    </li>
                    <li>
                    <a ng-click=" showfrontimage()" >
                           <i> <img src="icons/front.png" style="margin-top: 5px;" width="50px"height="30px" ></i>
                            <p style="margin-top: 0px;">Front</p>
                        </a>
                          
                    </li>
                   
                    
               </ul>
              
              
            </div><!-- /.navbar-collapse -->
          </div><!-- /.container-fluid -->
        </nav>
 


<div class="container  " style="width:100vw; padding:20px; padding-left: 80px; text-align:center; background-color: #889dccd9;" >
<div class="col-lg-7" id="grid" style="box-shadow: 0px 0px 20px black; background-color: black;"  >
	
	<div id="canvasesdiv" style="position:relative; width:100%; text-align: center; "  >
<!-- <canvas ng-mouseover="stoptimer();" ng-mouseleave="replacebytime();callintervalonplay();" id="layer1"
style="z-index: 1;
position:relative;" width="400px" height="400px" >
This text is displayed if your browser does not support HTML5 Canvas.
</canvas> -->

<!-- 
<canvas id="layer2"
style="z-index: 2;
position:absolute ;
left:0px;
top:0px;

" >
This text is displayed if your browser does not support HTML5 Canvas.
</canvas> -->
<div class="row">

<div class="col-lg-6" style="padding: 10px;" ng-repeat="item in urlarray">
<div class="containerimage">
  <img src="{{item.url}}" alt="Avatar" class="img-responsive image" style="">
  <div class="middle">
    <div class="btn btn-sm btn-success" ng-click="imgonclick(item)"><i class="fa fa-arrows-alt"></i></div>
    <div class="btn btn-sm btn-success" style="margin-top: 10px;" ng-click="cmntonclick(item.imagename);"><i class="fa fa-comment"></i></div>
  </div>
</div>
</div>


<!-- 
<div class="col-lg-6" style="padding: 10px;">
<div class="containerimage">
  <img src="users/{{patientid}}/Gifs/RIGHT.gif" alt="Avatar" class="img-responsive image" style="">
  <div class="middle">
    <div class="btn btn-info"  ng-click="imgonclick('RIGHT.gif')"><i class="fa fa-arrows-alt"></i></div>
    <div class="btn btn-info" style="margin-top: 10px;"><i class="fa fa-comment"></i></div>
  </div>
</div>
</div>
<div class="col-lg-6" style="padding: 10px;" >
<div class="containerimage">
  <img src="users/{{patientid}}/Gifs/LEFT.gif" alt="Avatar" class="img-responsive image" >
  <div class="middle">
    <div class="btn btn-info" ng-click="imgonclick('LEFT.gif')"><i class="fa fa-arrows-alt"></i></div>
    <div class="btn btn-info" style="margin-top: 10px;"><i class="fa fa-comment"></i></div>
  </div>
</div>
</div>
</div>
<div class="row">
<div class="col-lg-6" style="padding: 10px;" >
<div class="containerimage">
  <img id="myImg" src="users/{{patientid}}/Gifs/UPPER.gif"  alt="Avatar" class="img-responsive image" >
  <div class="middle">
    <div class="btn btn-info" ng-click="imgonclick('UPPER.gif')" ><i class="fa fa-arrows-alt"></i></div>
    <div class="btn btn-info" style="margin-top: 10px;"><i class="fa fa-comment"></i></div>
  </div>
</div>
</div>
<div class="col-lg-6"  style="padding: 10px;">
<div class="containerimage">
  <img src="users/{{patientid}}/Gifs/LOWER.gif"  alt="Avatar" class="img-responsive image" >
  <div class="middle">
    <div class="btn btn-info" ng-click="imgonclick('LOWER.gif')"><i class="fa fa-arrows-alt"></i></div>
    <div class="btn btn-info" style="margin-top: 10px;"><i class="fa fa-comment"></i></div>
  </div>
</div>
</div>
 -->
</div>

</div>

      
</div>

<div class="col-lg-4" style="margin-left:20px; height:440px;  box-shadow: 0px 0px 20px black; background-color: #f1f1f1f5;">
	<div ><img id="splimage"  width="100%" style="border: none;"> </div>
</div>
</div>

    <!--  <div style="text-align: center;"><label>Timer :</label> <button class="badge" ng-click=" replacebytime();callinterval();" > > </button> <button ng-click="stoptimer();" class="badge" > || </button> </div> -->

 <div class="player row" style="background-color:black; margin-top:20px; padding: 10px; ">
 	<div class="col-lg-3">
    <button type="button" id="button_fbw" class="btn" onclick='' ng-click="urlarrayindex=0; replacebytime();callintervalonplay();">
      <i class="fa fa-fast-backward"></i>
    </button>
    
    <button type="button" id="button_bw" class="btn" onclick='' ng-click="urlarrayindex=urlarrayindex-2; replacebytime();callintervalonplay();">
      <i class="fa fa-backward"></i>
    </button>
    
    <button type="button" id="button_play" class="btn" ng-click="replacebytime();callintervalonplay(); " >
      <i class="fa fa-play"></i>
    </button>
    
    <button type="button" id="button_stop" class="btn"  ng-click="stoptimer();">
      <i class="fa fa-stop"></i>
    </button>
    
    <button type="button" id="button_fw" class="btn"  ng-click="replacebytime();callintervalonplay();" >
      <i class="fa fa-forward"></i>
    </button>
    
    <button type="button" id="button_ffw" class="btn" onclick='' ng-click="urlarrayindex=urlarray.length-1; replacebytime();callintervalonplay();" >
      <i class="fa fa-fast-forward"></i>
    </button>    
    </div>
    
    <div class="col-lg-9" >
    
    <input style="margin-top: 15px; margin-left:-15px; width: 100%" type="range" class="slider" ng-change="slidervaluechanged(slidervalue); showcommenttextarea=true;"  ng-model="slidervalue"   min="0" max="{{urlarray.length-1}}" >
    
    </div>
    
    
  </div>
  <br>
  <div class="row" >
  <div class="col-lg-3" ></div>
  <div class="col-lg-9" style="text-align: right;" ng-show="showcommenttextarea" >
  <textarea class="form-control"  ng-model="comment" placeholder="Add Comment at Stage {{urlarrayindex}}"></textarea>
  <br>
  <button  class="btn btn-primary" ng-click="savejson();" >Add Comment</button>
  </div>
  
  </div>
 
  <div class="row" style="padding: 30px;" >
<label>Comments:</label>
  <table class="table table-condensed table-striped table-bordered"  ng-init="fetchjson();" style="text-align: center;"> 
  <thead style="background-color: black; color: white;">
	<tr>
	<th style="text-align: center;">Stage</th>
	<th style="text-align: center;" >User</th>
	<th style="text-align: center;" >Comment</th>
	<th style="text-align: center;" >DateTime</th>
	</tr>  
  </thead>
  <tbody>
  <tr ng-repeat="item in commentdata">
  <td style="max-width: 100px;">{{item.stage}}</td>
  <td style="max-width: 50px;" >{{item.user}}</td>
  <td style="min-width: 200px;" > {{item.comment}}</td>
  <td style="max-width: 100px;" >{{item.timestamp}}</td> 
  </tr>
  </tbody>
  
  </table>
  </div>
  
  
 

    <script type="text/javascript">
    
    var app=angular.module("app", []);
    
    app.controller("cont", function($scope,$http,$interval) {
    	$scope.patientid="user2";
    	$scope.slidervalue=0;
    	$scope.showcommenttextarea=false;
    	/* var canvas = document.getElementById('layer1');
        var viewer = new JSC3D.Viewer(canvas);
        var theScene = new JSC3D.Scene;
        var numOfLoaded = 0;
        	
            
            viewer.setParameter('BackgroundColor1', '#00FFFFFF');
            viewer.setParameter('BackgroundColor2', '#00FFFFFF');
            viewer.setParameter('Renderer', 'webgl');
           	viewer.setRenderMode('texturesmooth');
           	//viewer.setDefinition('high');
           //	viewer.generateBackground();
        	viewer.setParameter('Definition', 'high');
        	viewer.setParameter("Background", 'Off'); 
            viewer.init();
            viewer.update();
            
           
        
        $scope.changescene=function(scenurl){
        	 $interval.cancel(intervalvar);
        	viewer.replaceSceneFromUrl(scenurl);
        	$scope.urlarrayindex=$scope.urlarray.indexOf(scenurl)+1;
        	
        }
      
       
      */
        
        $scope.showsplimage=function(){
        	document.getElementById("splimage").height=430;
        	document.getElementById("splimage").src="users/"+$scope.patientid+"/number.jpg";
        }
      
      $scope.showfrontimage=function(){
      	document.getElementById("splimage").height=430;
      	document.getElementById("splimage").src="users/"+$scope.patientid+"/Gifs/FRONT.gif";
      }
        $scope.userpathforstl="users/"+$scope.patientid+"/stl/";
        $scope.userpathforgifs="users/"+$scope.patientid+"/Gifs/";
        $scope.urlarray=[];
        
        $http.post("rest/giffiles", JSON.stringify({"user":$scope.patientid})).then(function(value) {
        	$scope.totalarray=value.data.gifs;
        	for(i=0;i<value.data.gifs.length;i++){
        		if(value.data.gifs[i].toString()!='FRONT.gif'){
        		$scope.urlarray.push({"url":$scope.userpathforgifs+value.data.gifs[i],"imagename":value.data.gifs[i].split(".")[0]});
        		}
        	}
        	/* viewer.setParameter("SceneUrl",$scope.urlarray[0]);
        	viewer.setParameter('ModelColor', '#888888');
        	viewer.init(); */
        }, function(reason) {
        	
        }, function(value) {
        	
        })
        
        $scope.urlarrayindex=1;
       	
       
        var modal = document.getElementById('myModal');
    	
   	 // Get the image and insert it inside the modal - use its "alt" text as a caption
   	 
   	 var modalImg = document.getElementById("img01");
   	 var captionText = document.getElementById("caption");
   	 $scope.imgonclick = function(source){
   	     modal.style.display = "block";
   	     modalImg.src = source.url;
   	     
   	     captionText.innerHTML = source.imagename;
   	 }
   	
   	 // Get the <span> element that closes the modal
   	 var span = document.getElementsByClassName("closebutton")[0];
   	
   	 // When the user clicks on <span> (x), close the modal
   	 span.onclick = function() { 
   	     modal.style.display = "none";
   	 }
	
   	 $scope.cmntonclick = function(imgname){
   		$scope.openimage=imgname;
   		angular.element('#commentModal').modal('show');
   	     //modalImg.src = source.url;
   	     
   	     //captionText.innerHTML = source.imagename;
   	 }
        
        $scope.replacebytime=function() {
        	$scope.showcommenttextarea=false;
            	if($scope.urlarray.length<1){
            		return;
            	}
        		
            	if($scope.urlarrayindex<$scope.urlarray.length){
            	viewer.replaceSceneFromUrl($scope.urlarray[$scope.urlarrayindex]);
            	viewer.setParameter('ModelColor', '#888888');
            	//$scope.changeslidervalue($scope.urlarrayindex);
            	//alert($scope.slidervalue);
            	$scope.slidervalue=$scope.urlarrayindex;
            	$scope.urlarrayindex++;
            	
            	}
            	else{

            		$scope.urlarrayindex=0;
            		$scope.replacebytime();
            	}
            } 
        
        $scope.savejson=function(){
            //intervalvar=$interval($scope.replacebytime, 5000);
            $scope.commentjson={};
            $scope.commentjson.patient=$scope.patientid;
            $scope.commentjson.user="LoginUser1";
            $scope.commentjson.stage=$scope.openimage;
            $scope.commentjson.timestamp=new Date();
            $scope.commentjson.comment=$scope.comment;
            
             $http.post("rest/savejson", JSON.stringify($scope.commentjson)).then(function(value) {
        	
            	 $scope.commentdata=value.data;
        	
        }, function(reason) {
        	
        }, function(value) {
        	
        })
            
         }
        
        $scope.fetchjson=function(){
        	$scope.commentjson={};
            $scope.commentjson.patient=$scope.patientid;
            $scope.commentjson.user="LoginUser1";
         $http.post("rest/fetchjson", JSON.stringify($scope.commentjson)).then(function(value) {
       	
           	 $scope.commentdata=value.data;
       	
       }, function(reason) {
       	
       }, function(value) {
       	
       })
        	
         }
        
        $scope.callinterval=function(){
        intervalvar=$interval($scope.replacebytime, 5000);
        }
        
        $scope.callintervalonplay=function(){
        	 $interval.cancel(intervalvar);
        intervalvar=$interval($scope.replacebytime, 5000);
        }
        
        $scope.stoptimer=function(){
        $interval.cancel(intervalvar);
        }
        
        
        
        
        var gridnumber=0;
        $scope.drawboard=function(){
       			
        	
        	
           		var p = 0;

               var canvas = document.getElementById("layer2");
               var bw =canvas.width;
               // Box height
               var bh = canvas.height;
               var context = canvas.getContext("2d");
               if(gridnumber>0){context.clearRect(0, 0, canvas.width, canvas.height );
               context.save();
               gridnumber=0;
               changecanvassize();
               canvas.style.border = "";
               }
               else{
           	  for(var x=0.5;x<bw;x+=10) {
                     context.moveTo(x,0);
                     context.lineTo(x,bh);
                   }

                   for(var y=0.5; y<bh; y+=10) {
                     context.moveTo(0,y);
                     context.lineTo(bw,y);

                 }

           context.strokeStyle = "hsla(0, 1%, 67%, 0.65)";
           context.stroke();
           gridnumber=1;
           canvas.style.border = "1px solid hsla(0, 1%, 67%, 0.65)";
           }
        }
    
        $scope.slidervaluechanged=function(slidervalue){
        	//alert(slidervalue);
        	$scope.changescene($scope.urlarray[slidervalue]);
        }
    })

    </script>
    
    <script type="text/javascript">
    
    var changecanvassize=function(){

        var ctrl2 = document.getElementById("layer1");
        var ctrl = document.getElementById("layer2");
        parentSize = ctrl.parentNode.getBoundingClientRect();


    	ctrl2.width  = parentSize.width;
    	ctrl2.height = parentSize.height-5;
    	
        
    	ctrl.width  = parentSize.width;
    	ctrl.height = parentSize.height-5;
    }
	 
 
    
    
    
    </script>
<div id="myModal" class="modal">
  <span class="closebutton">x</span>
  <img class="modal-content" id="img01">
  <div id="caption"></div>
</div>


 <!-- Modal -->
  <div class="modal fade" id="commentModal" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Comments</h4>
        </div>
        <div class="modal-body">
           <textarea class="form-control" ng-model="comment" placeholder="Add Comment at {{openimage}}" ></textarea>
        </div>
        <div class="modal-footer">
          <div style="text-align: right;"><button class="btn btn-primary" ng-click="savejson();" data-dismiss="modal" >Add Comment</button> </div>
        </div>
      </div>
      
    </div>
  </div>
    
</BODY>
</HTML>
